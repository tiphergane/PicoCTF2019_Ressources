#coding:utf-8
import requests
import re

#variables applicatives
regex = "picoCTF{.*?}"
url = "https://picoctf.com/resources"
s = requests.Session()

#fontion ConnClose, logique de fermeture de la connection
def ConnClose():
    print("[*] Closing connection")
    s.close()
    input()
    
#Fonction Exploit, payload/code à éxécuter, à modifier selon le problème du CTF
def Exploit():
    print("[*] Connection to %s" % url)
    r = s.get(url)
    print("[*] Doing Black magic")
    r = r.content
    print("[*] Working hard")
    result = re.findall(regex, str(r))
    flag = result
    print("[*] What does the cat says ?")
    if not str(result):
        print("[*] Bad Luck my friend")
    else:
        for f in flag:
            print("[*] Lucky you, flag is : %s " % f)

#Fonction ConnOpen, logique d'ouverture du stream HTTP vers le serveur
def ConnOpen():
    try:
        Exploit()
    except:
        print("[*] Impossible de se connecter à %s" % url)
        print("[*] Exploit failed")
    finally:
        ConnClose()
            
#Program Main
ConnOpen()
